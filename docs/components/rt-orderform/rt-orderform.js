const[t,e]=rtlib.parseCompURL(import.meta.url);customElements.define(t,class extends rtBC.RTBaseClass{#t;#e;#r;#s;#i;#o;#a;constructor(){super(),this.#i=this.attachShadow({mode:"open"}),this.#i.append(this.$getTemplate());this.id="eventBus",this.#r=this.#i.querySelector("form#user-form"),this.#e=this.#i.querySelector("#product-details"),this.#s=this.#i.querySelector("#menu-items-container"),this.#t=this.#i.querySelector("#cart"),this.#o=new Map(Object.entries(JSON.parse(localStorage.getItem("currentOrder"))||{})),this.#a=window.matchMedia("(max-width: 430px)").matches;const t={handleEvent:this.#n,orderNode:this};this.addEventListener("initdetails",t),this.#s.addEventListener("updatecountitem",t=>{t.stopPropagation(),this.#l()}),this.#t.addEventListener("cartmod",t=>this.#c(t)),this.#i.querySelector("#product-details-close").addEventListener("click",t),this.#i.querySelector("#prod-add-but").addEventListener("click",t=>this.#d(t)),this.#i.querySelector("#further-but").addEventListener("click",()=>this.#u()),this.#i.querySelector("#recover-but").addEventListener("click",()=>this.#h()),this.#i.querySelector("#submit-but").addEventListener("click",()=>this.#m()),this.#i.querySelector("#cancel-but").addEventListener("click",()=>{this.#p(!1),this.#i.querySelector("div#cart").style.display="",this.#r.reset()})}connectedCallback(){"undefined"!=typeof rtForm&&rtForm.getStyle(this,rtForm.findNode(this)),setTimeout(()=>{this.$dispatch({name:"formready"})},0)}#f(){const t=new Map([["further",this.#i.getElementById("further-but")],["last",this.#i.getElementById("recover-but")]]);for(const[e,r]of t)r.style.display="none";let e;const r=0===this.querySelectorAll("rt-lineitem").length;switch(!0){case r&&null!==localStorage.getItem("lastOrder"):e="last";break;case!r&&"none"===this.#i.querySelector("#form-container").style.display:e="further";break;default:e=null}e&&(t.get(e).style.display="")}#g(t){if(!(t instanceof Map&&t.has("prodID")&&t.has("count")))return void console.error('#cartCurOrderUpdate() : "item" not in expected form');const e=new Map([["updated",!1],["found",!1]]),r=t.get("prodID"),s=t.get("count");return this.#o.size>0&&this.#o.has(r)&&(e.set("found",!0),s!==this.#o.get(r)&&(0===s?this.#o.delete(r):this.#o.set(r,s),e.set("updated",!0))),!e.get("found")&&s>0&&(this.#o.set(r,s),e.set("updated",!0)),e.get("updated")}#y(){[...this.querySelectorAll("rt-lineitem")].forEach(t=>t.remove());let t=0;if(this.#o.size){const e=[];this.#o.forEach((r,s)=>{const i=this.querySelector(`rt-itemline[prodid="${s}"]`),o=i.parentElement,a=`${o.parentElement.querySelector("item-title").innerText}<br/>${o.getAttribute("value")} ${o.getAttribute("desc")}<br/>${i.innerText}`,n=i.getAttribute("prijs");t+=parseInt(n)*r,e.push(this.$createElement({tag:"rt-lineitem",innerHTML:a,attrs:{slot:"cart",prodid:s,unit:n}}))}),this.append(...e)}this.#i.querySelector("#order-total-amount").innerHTML=this.$euro(t/100),this.#f()}#S(){const t=this.#t.classList;t.contains("mini")?t.remove("mini"):t.add("mini")}#_(){let t=0;this.querySelectorAll("rt-lineitem").forEach(e=>{t+=parseInt(e.$attr("unit"))*parseInt(e.count)}),this.#i.querySelector("#order-total-amount").innerHTML=this.$euro(t/100)}#d(t){if(t){if(t.stopPropagation(),"prod-add-but"!==t.target.id||t.target.classList.contains("button-dis"))return;const e=new Map([["changed",!1]]),r=this.querySelectorAll('[slot="active-data"] rt-itemline[updated]');if(0===r.length)return;r.forEach(t=>{this.#g(new Map([["prodID",t.$attr("prodid")],["count",parseInt(t.count)]]))&&!e.get("changed")&&e.set("changed",!0),t.removeAttribute("updated")}),e.get("changed")&&(this.#o.size>0?localStorage.setItem("currentOrder",this.$map2JSON(this.#o)):localStorage.removeItem("currentOrder"),this.#y())}this.#n()}#l(){const t=getComputedStyle(this).getPropertyValue("--OF-HIDE-UPDATE"),e=this.shadowRoot.querySelector("#prod-add-but").classList;this.querySelectorAll("rt-itemdata[slot] rt-itemline[updated]").length>0?(e.remove("button-dis"),t&&e.remove("button-hide")):(e.add("button-dis"),t&&e.add("button-hide"))}#n(t){if(t instanceof Event){t.stopPropagation();const e=this.orderNode;if(e)if(t.detail.id){const r=t.detail.id;e.querySelectorAll("rt-itemdata").forEach(t=>t.removeAttribute("slot"));const s=e.querySelector(`rt-itemdata#${r}`);s.setAttribute("slot","active-data"),s.querySelectorAll("rt-itemline").forEach(t=>{t.count=e.#o.has(t.$attr("prodid"))?e.#o.get(t.$attr("prodid")):0,t.render()}),e.#l(),e.#e.showModal()}else e.#e.close()}else this.#e.close()}#b(){}#p(t){this.#s.querySelector("#menu").style.display=t?"none":"",this.#s.querySelector("#form-container").style.display=t?"":"none",this.#f()}#v(){const t=new Map([["failed",!1]]);if(this.#r){const e=this.#r.querySelectorAll("rt-form-field[required], rt-pickuplocations");for(const r of e){const e=r.checkValidity();if(!e.get("valid")){const s=e.get("field");r.focus(s),t.set("failed",!0),t.set("field",s);break}}}return t}#u(){const t=localStorage.getItem("user-details");t&&(this.#r.querySelector("#savefields").checked=!0,this.$JSON2map(t).forEach((t,e)=>this.#r.querySelector(`[name=${e}]`).value=t)),this.#p(!0),this.#a&&this.#S()}#m(){const t=this.#v();if(t.get("failed"))console.warn(`Form submission not valid - ${t.get("field")}`);else{const t=new FormData(this.#r);this.$dispatch({name:"neworder",detail:{person:Object.fromEntries(t.entries()),order:Object.fromEntries(this.#o)}})}}#C(){const r=this.querySelector('div[slot="user-form"]');if(!r)return console.error("User details form is missing!!"),void this.#i.querySelector("#menu-items-container").append(document.createRange().createContextualFragment('<h1 style="color: red;">User details form is missing from data file!!</h1>'));this.#i.querySelector("form#user-form").append(r),r.removeAttribute("slot");const s=this.querySelector("form-config span#imgpath").textContent,i=[...this.querySelectorAll("rt-itemdata")];if(this.append(...i.map(t=>{let e={id:`mi-${t.id}`,slot:"menu-items"},r=t.querySelector("img");return r&&(e.bgimg=`${s}/${r.getAttribute("file")}`),this.$createElement({tag:"of-menuitem",innerHTML:`${t.querySelector("item-title").innerHTML}`,attrs:e})})),this.#a){const t=this.#t.querySelector("#cart-title");t.addEventListener("click",()=>this.#S()),setTimeout(()=>{const e=getComputedStyle(this.#t),r=2*parseInt(e.paddingTop)+2*parseInt(e.borderLeftWidth),s=`${(parseFloat(t.getBoundingClientRect().height)+r).toFixed(0)}px`;this.#t.style.setProperty("--MINIMIZED-CART",s),this.#t.classList.remove("init")},200)}this.#i.querySelector("#product-details-close img").src=`${e}/components/${t}/img/close-blk.png`,this.#s.querySelector("#menu").style.display="",this.#y()}#c(t){t.stopPropagation(),this.#g(new Map([["prodID",t.detail.prodID],["count",t.detail.count]])),this.#o.size>0?localStorage.setItem("currentOrder",this.$map2JSON(this.#o)):localStorage.removeItem("currentOrder"),this.#_()}#h(){localStorage.getItem("lastOrder")&&localStorage.setItem("currentOrder",localStorage.getItem("lastOrder")),this.#o=this.$JSON2map(localStorage.getItem("currentOrder")),this.#y()}get cartContents(){return this.#o}accepted(){localStorage.setItem("lastOrder",localStorage.getItem("currentOrder")),localStorage.removeItem("currentOrder"),this.#o.clear(),this.#y();const t=this.#i.querySelector("#savefields");if(t&&t.checked){const t=[...this.#i.querySelectorAll("#formfields :is(rt-form-field, textarea)")].reduce((t,e)=>t.set(e.name,e.value),new Map);localStorage.setItem("user-details",this.$map2JSON(t))}else localStorage.removeItem("user-details");this.#r.reset(),this.#p(!1),console.log("Form Submitted!")}async loadMenu(r){try{if(void 0===r)throw new Error("No Datafile",{cause:"nofile"});const s=await fetch(r);if(!s.ok)throw new Error("Datafile URL is not valid",{cause:"invalid"});const i=await s.text(),o=document.createRange().createContextualFragment(i);this.appendChild(o);const a=[...new Set(Array.from(this.querySelectorAll("*")).map(t=>{const e=t.tagName.toLowerCase();if(0===e.indexOf("rt-"))return e}).filter(t=>t).concat(["rt-lineitem"]))];await Promise.all(a.map(async r=>{try{await import(`${e}/components/${r}/index.js`)}catch(e){throw`Component "${t}" could not load dependency "${r}" so stopping!!`}})),this.#C()}catch(t){let e;switch(console.error(t),t.cause){case"nofile":e='<h1 style="color: red;">Datafile URL not provided</h1>';break;case"invalid":e='<h1 style="color: red;">Datafile URL is not valid</h1>';break;default:e=""}const r=document.createRange().createContextualFragment(e);this.#i.querySelector("#menu-items-container").appendChild(r)}this.style.display="inline-block"}});